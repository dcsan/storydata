rooms:
  #--------------- cell --------------------

  - name: cell
    state: default
    states:
      # actually same as task1
      - name: default
        short: "You are in what appears to be an inmate‚Äôs bedroom. \n
          You see a bed, a wardrobe, a desk, a sink, a window, a door, lights, and a wall covered with images."
        imageUrl: asylum/rooms/cell.jpg
        buttons:
          - look room | task1

        # buttons:
        # - door | x door
        # - sink | x sink
        # - desk | x desk
        # - wall | x wall
        # - notebook | x notes
        # - wardrobe | x wardrobe
      # intro to the room
      - name: task1
        imageUrl: asylum/rooms/cell.jpg
        short: "You are in what appears to be an inmate‚Äôs bedroom. \n
          You see a bed, a wardrobe, a desk, a sink, a window, a door, lights, and a wall covered with images.
          \nA strip of lights is on the wall, but none are on"

      # repeat room description
      - name: task2
        imageUrl: asylum/rooms/cell-1.jpg
        short: "You are in what appears to be an inmate‚Äôs bedroom. \n
          You see a bed, a wardrobe, a desk, a sink, a window, a door, lights, and a wall covered with images.
          \n
          \nOne of the lights has come on.
          "
      - name: task3
        imageUrl: asylum/rooms/cell-2.jpg
      - name: task4
        imageUrl: asylum/rooms/cell-dark.jpg
      - name: task5
        imageUrl: asylum/rooms/cell-4.jpg

    actions:
      - match: take poster
        always:
          reply: "You turn the poster over to see the following scrawled in black Sharpie: \n
            \n> Four good boys in turns did wash
            \n> First was Hans the boy from Ansbach
            \n> Next was Nick with ruddy skin
            \n> While Piers did follow after him
            \n> The last was Fez a swarthy chum
            \n> He did the deed then all were done.
            "

      - match: ^(wash|wash face|wash face with soap|wash hands with soap)$
        if:
          all:
            - soap.has = yes
        then:
          after:
            - washalert
        else:
          reply: you don't have any soap

      - match: ^use soap$
        if:
          all:
            - soap.has = yes
        then:
          reply: Use soap to do what?
        else:
          reply: you don't have any soap

      - match: ^use soap on sink$
        if:
          all:
            - soap.has = yes
        then:
          reply: You use the soap, but cleaning the sink doesn't do much.

      - match: wash (yourself) with soap|wash with soap|use soap to wash|wash with soap
        then:
          after:
            - washalert

      - match: ^(wash hands|wash ears|wash neck|wash face|wash up)$
        then:
          after:
            - washalert

      - match: washalert
        then:
          reply: "
            The voice crackles out.
            \n> _'Follow proper procedure, Jack. Michael has told you how.'_
            "

      - match: use sink
        if:
          all:
            - sink.handle = yes
        then:
          reply: You use the new handle to run the water.
        else:
          reply: The handle is missing.

      - match: ^use handle$
        if:
          all:
            - handle.has = yes
        then:
          reply: Use the handle where?
        else:
          reply: You aren't holding a handle.

      - match: use handle on sink
        if:
          all:
            - handle.has = yes
        then:
          imageUrl: asylum/shots/sink-handle.jpg
          reply: You attach the handle to the faucet.
          setProps:
            - sink.handle = yes
        else:
          reply: You don't have a handle.

      - match: sit .* (chair|desk)
        then:
          reply: You sit on the uncomfortable chair. Nothing happens aside from... discomfort.

      - match: enter bed
        then:
          reply: You're not tired.
      - match: enter wardrobe
        then:
          reply: This is not a C.S. Lewis novel...

      - match: open window
        then:
          reply: The bars prevent access to the window.

      - match: ^notes$
        then:
          before:
            - x notebook

      - match: open desk
        always:
          reply: You look in the desk drawer and find a notebook.
          setProps:
            - desk.state = open

      - match: shut desk
        always:
          reply: You close the desk drawer.
          setProps:
            - desk.state = shut
          after:
            - x desk

      - match: search desk
        always:
          reply: You don't find anything interesting.
          setProps:
            - desk.state = open
          after:
            - x desk

      # ------  task: dress ---------
      - match: open wardrobe
        always:
          reply: You open the wardrobe.
        if:
          all:
            - robe.has = yes
        then:
          setProps:
            - wardrobe.state = openEmpty
            - wardrobe.open = yes
          after:
            - x wardrobe
        else:
          setProps:
            - wardrobe.open = yes
            - wardrobe.state = openRobe
          after:
            - x wardrobe

      # close and retain state based on if youer wearing clothes
      - match: shut wardrobe
        always:
          reply: The doors creak as you close them.
        if:
          all:
            - handle.has = yes
        then:
          setProps:
            - wardrobe.state = closedOneHandle
          after:
            - x wardrobe

        else:
          setProps:
            - wardrobe.state = closed
          after:
            - x wardrobe

      - match: take handle
        if:
          all:
            - handle.has = no
        then:
          reply: You remove the odd looking handle from the wardrobe.
          take:
            - handle
          setProps:
            - handle.has = yes
            - wardrobe.state = closedOneHandle
        else:
          reply: You already have the handle

      # need to add code to alllow multiple ifs / branches
      - match: take robe
        if:
          all:
            - wardrobe.open = yes
            - robe.has = no
        then:
          reply: You've put on the blue robe.
          take:
            - robe
          setProps:
            - robe.has = yes
            - wardrobe.state = openEmpty
          after:
            - checkTask1
        else:
          reply: You can't see a robe. # could be either shut/has

      - match: take sandals
        then:
          reply: You slip on the blue sandals.
          take:
            - sandals
          setProps:
            - sandals.has = yes
            - bed.state = nosandals
          after:
            - checkTask1

      - match: drop sandals
        then:
          reply: You put the sandals back under the bed.
          # drop:
          #   - sandals
          setProps:
            - sandals.has = no
            - bed.state = default
          after:
            - checkTask1

      - match: checkTask1
        if:
          all:
            - robe.has = yes
            - sandals.has = yes
        then:
          reply: You're fully dressed now.
          after:
            - task2
        else:
          reply: "
            \n> _'You're halfway there, Jack.'_
            "

      # TRIGGER 1 - get dressed
      - match: task1
        then:
          reply: "‚ûñ‚ûñ‚ûñ‚ûñ\n
            Before you can move, a voice crackles over a hidden speaker in the room.
            \n> _‚ÄúTo proceed to breakfast, please follow your morning routine.
            Remember, every good boy dresses sharply.‚Äù_"
          setProps:
            - notebook.state = task1
            - room.state = task1

      # TRIGGER 2 - do exercise
      - match: task2
        then:
          reply: "üí°‚ûñ‚ûñ‚ûñ\n
          The bottom bulb in a column of four has come on, now glowing a bright green above the others.
            The same voice crackles over the speaker.
            \n> _‚ÄúThat‚Äôs a good boy, Jack. Now remember, exercise makes the man. Just as many times as there are legs in the room.‚Äù_"
          setProps:
            - notebook.state = task2
            - room.state = task2

      # TRIGGER #3 - get washed
      - match: task3
        then:
          reply: "üí°üí°‚ûñ‚ûñ\n
          The second in the column of four green lightbulbs lights up and theinvisible speaker crackles.
            \n> _‚ÄúWell done, young Jack. You‚Äôre fit as a fiddle. And now it‚Äôs time for all good boys to scrub away those mean, nasty germs. Let‚Äôs not be careless, now. Follow proper procedure.‚Äù_
            "
          setProps:
            - notebook.state = task3
            - room.state = task3

      # TRIGGER #4 - color puzzle
      - match: task4
        then:
          reply: "üí°üí°üí°‚ûñ\n
            The third green light in the column above the sink turns on and the voice is encouraging this time.
            \n> _‚ÄúJack, my boy, you‚Äôre a wonderful lad.
            Limber and loose and clean as a goose. And dressed up so nicely to boot!‚Äù_"
          # imageUrl: xxx
          buttons:
            - ask where my real clothes are | realclothes
          setProps:
            - notebook.state = task4
            - room.state = task4

      - match: ask where my real clothes are|real clothes|cracked|realclothes|ask about clothes|ask clothes|ask where
        then:
          imageUrl: asylum/rooms/cell-dark.jpg
          reply: Suddenly, there is a deep crack, and all the lights drop out in the facility.
            All that remains is the artificial yellow glow from outside your window
            and the three illuminated green lightbulbs above the sink.
          buttons:
            - ask about those terms and conditions | termsandconds

      - match: termsandconds|ask about [.*|] terms|ask about terms
        then:
          reply: "
            \n>_‚ÄúJackkkk‚Ä¶‚Äù_
            The voice is faint and eerie, like a record being played at the wrong speed.
            "
          after:
            - greenMessage

      - match: greenMessage
        then:
          reply: "
            \n>
            _‚ÄúI‚Äômmm envioussss of youuu Jackkk. Can you matchhhhh the collllllor of my envyyyy, Jackkk?‚Äù_
            "

      # task 4 win
      - match: use sandals on window|use robe on window|use sandals with window|use robe with window|task5
        if:
          all:
            - notebook.state = task4
        then:
          reply: "üí°üí°üí°üí°\n
            You remove the sandals and lift them to the window.
            Immediately, their light blue color is transformed to green by the yellow light without.
            The fourth and final green lightbulb above the sink blinks on, followed by a resounding crack.
            The lights of the facility pulse as they come on once again.\n
            As you put the sandals on once again, you hear a loud click from the bedroom door."
          setProps:
            - door.state = open
            - room.state = task5
        else:
          reply: Nothing special happens.

      # TRIGGER #5
      - match: exit room|open door|use door
        if:
          all:
            - robe.has = yes
            - door.state = open
        then:
          reply: You step into the hallway, pleased with your accomplishment.
          goto: epilogue
        else:
          reply: The door won't open.

      # door
      - match: open sesame
        then:
          reply: You shout "sesame" to the room.
            Slowly, the door opens.
          setProps:
            - door.state = open

      # exit via door
      - match: exit|leave|back
        always:
          reply: You try the door.
        if:
          all:
            - door.state = locked
        then:
          reply: It's locked.
        else:
          reply: It opens.
          goto: epilogue

      - match: exercise
        then:
          reply: What kind of exercise?

      # has to come before next one since that matches just 'jacks'
      - match: 24 jumping jacks|24 jacks|24 jumping jacks|jump 24 times|jump 24
        if:
          all:
            - tasks.state = task2
        then:
          reply: You slip out of your blue sandals and perform 24 jumping jacks in your socks.
            You can‚Äôt remember doing these since childhood. It‚Äôs rather fun, actually.
          after:
            - task3
        else:
          reply: "
            \n>_‚ÄúLet's not get ahead of ourselves, now, Jack. Follow instructions, lad.‚Äù_
            "

      - match: jump (18|16|4)
        then:
          reply: I think there are more legs than that in this room. Better check with Leo.

      - match: ^(jump|jumping jacks|jacks)$
        then:
          reply: You'll have to say how many...

      - match: use handle on sink|attach handle to sink|use handle with sink
        if:
          all:
            - handle.has = yes
        then:
          setProps:
            - sink.handle = yes
            - sink.state = handle
          reply: You attach the handle to the sink faucet. It seems to fit perfectly.
        else:
          reply: You don't have a handle.

      - match: look pillow
        if:
          all:
            - soap.has = yes
        then:
          reply: A soiled pillow case. Nothing inside.
        else:
          reply: there's a bar of soap inside the pillowcase
          setProps:
            - soap.seen = yes

      # soap
      # still has the problem when you have the soap
      # as we can't do multiple IFs/switch statement
      - match: take soap
        if:
          all:
            - soap.has = no
            - soap.seen = yes
        then:
          reply: You take the soap out of the pillowcase
          take:
            - soap
          setProps:
            - pillow.state = noSoap
        else:
          reply: what soap?

      - match: drop soap
        always:
          setProps:
            - pillow.state = hasSoap
            - soap.has = no
          drop:
            - soap

      # right answer! moves to task4
      - match: wash hands neck ears face
        then:
          callJS: checkWashing

      - match: look under bed
        if:
          all:
            - sandals.has = yes
        then:
          reply: You see a pair of blue plastic sandals.
        else:
          reply: It's a bit dirty down there, but you don't see anything particular interesting.

      - match: turn handle|turn faucet|turn water on
        if:
          all:
            - sink.handle = yes
        then:
          reply: Water begins trickling out. Now might be a good time to wash up...

      - match: use handle with sink
        if:
          all:
            - handle.has = yes
        then:
          reply: You attach the handle to the faucet.
          setProps:
            - sink.handle = yes

    items:
      - name: door
        state: locked
        states:
          - name: locked
            short: The door is tightly locked.
          - name: open
            short: The door has opened. Time to make your escape?

      - name: handle
        state: attached
        canTake: true
        hidden: true
        states:
          - name: attached
            short: That's an odd looking wardrobe handle...
          - name: holding
            short: One of the handles is missing from the wardrobe door.

      - name: pillow
        called: pillowcase|pillow case
        state: hasSoap
        hidden: true
        states:
          - name: hasSoap
            short: There's a bar of soap inside the pillowcase.
          - name: noSoap
            short: It's just an ordinary, head-stained pillow.

      - name: soap
        called: soap|bar of soap|soapbar
        canTake: true
        unique: true
        hidden: true
        # props:
        #   - seen: no
        states:
          - name: default
            short: It's an ordinary bar of soap.

      #-------- wardrobe
      - name: wardrobe
        called: wardrobe|cupboard|closet|wr
        state: closed
        canTake: false
        states:
          - name: closed
            imageUrl: asylum/items/wardrobe-shut.jpg
            short: A free-standing wooden wardrobe is against one wall.
            long: The wardrobe is cheaper than the one you remember from your college dorm.
              It has two narrow doors with rounded handles that look like flower petals.
          - name: closedOneHandle
            imageUrl: asylum/items/wardrobe-onehandle.jpg
            short: A free-standing wooden wardrobe is against one wall. One handle is missing
          # depends on clothes.has which state to show
          - name: openRobe
            imageUrl: asylum/items/wardrobe-robe.jpg
            short: You see a bathrobe hanging inside.
          - name: openEmpty
            imageUrl: asylum/items/wardrobe-empty.jpg
            short: The wardrobe is empty.

      - name: robe
        called: gown|robe|dressing gown|bathrobe
        canTake: true
        onTake: you put on the robe
        hidden: true
        states:
          - name: default
            short: It's a cheap, blue cotton bathrobe.

      - name: notebook
        called: notebook|note|book|memo|tasks|nb|notes|memo|notepad
        canTake: true
        state: start
        states:
          - name: start
            short: The notebook is blank. You can add notes here to remember things.
          - name: task1
            short: The voice had said _‚ÄúTo proceed to breakfast, please follow your morning routine.
              Remember, every good boy dresses sharply.‚Äù_
          - name: task2
            short: "The voice said
              _‚ÄúThat‚Äôs a good boy, Jack. Now remember, exercise makes the man.
              Just as many times as there are legs in the room‚Äù_
              \n\n
              Remember what exercise is best, Jack? If you don‚Äôt know yourself, ask Leo
              "
          - name: task3
            short: "The voice had said
              _‚ÄúAnd now it‚Äôs time for all good boys to scrub away those mean, nasty germs.‚Äù_
              \n\n
              Are you dreaming about soap, Jack? Maybe a fairy can help you"
          - name: task4
            short: "
              _‚ÄúI‚Äômmm envioussss of youuu Jackkk. Can you matchhhhh the collllllor of my envyyyy, Jackkk?‚Äù_
              "

      - name: sandals
        called: sandals|shoes|slippers
        onTake: You slip on the blue sandals
        hidden: true
        canTake: true
        states:
          - name: default
            short: They are translucent blue, and made of plastic.

      - name: bed
        called: under bed
        states:
          - name: default
            imageUrl: asylum/shots/bed-slippers.jpg
            short: A narrow metal bed is here with a soiled old pillow.
          - name: nosandals
            imageUrl: asylum/shots/bed.jpg
            short: A narrow metal bed is here with a soiled old pillow.

      - name: desk
        called: drawer|desk|squat desk|table
        states:
          - name: default
            imageUrl: asylum/shots/desk-shut.jpg
            short: A squat desk with chair sits beside the wardrobe.
          - name: open
            imageUrl: asylum/shots/desk-open.jpg
            short: The desk drawer is open.

      - name: chair
        states:
          - name: default
            short: It's an uncomfortable looking chair.

      - name: sink
        called: faucet
        states:
          - name: default
            imageUrl: asylum/shots/sink.jpg
            short: The handle is missing.
          - name: handle
            imageUrl: asylum/shots/sink-handle.jpg
            short: Now you can use the sink.

      - name: lights
        called: wall lights
        states:
          - name: default
            imageUrl: https://via.placeholder.com/500x200/444488/CCC.png?text=Lights
            short: A vertical row of small lightbulbs is built into the wall above the sink.

      - name: wall
        called: wall
        states:
          - name: default
            short: Some posters are on the wall.
            long: You see a drawing, a poster of an album cover, and a photo.
            imageUrl: asylum/shots/poster-wall.jpg

      - name: drawing
        called: man poster|vitruvian|davinci|da vinci|drawing|leonardo
        hidden: true
        canTake: true
        states:
          - name: default
            imageUrl: asylum/items/drawing.jpg
            long: It‚Äôs a reproduction of DaVinci‚Äôs classic drawing, ‚ÄúVitruvian Man,‚Äù except the figure looks a lot like you at the moment.

      - name: photo
        called: face photo|high-school|photo|school photo|pic|picture
        canTake: true
        hidden: true
        states:
          - name: default
            imageUrl: asylum/items/school-photo.jpg
            long: It‚Äôs you, from your senior year in high school, complete with forehead acne and love goggles. How did they manage to make a copy of this? Unnerving.

      - name: poster
        called: jackson|high-school|photo|poster|album|album cover
        hidden: true
        canTake: true
        states:
          - name: default
            imageUrl: asylum/items/album.jpg
            long: You remember this album cover from childhood.
              However, you don‚Äôt remember Michael holding a bar of soap in it.

      - name: window
        states:
          - name: default
            imageUrl: asylum/shots/window.jpg
            short: A rectangular window with bars is recessed into the far wall. A door leads out.
            long: The window is frosted and protected by metal bars from your side.
              Upon closer inspection, you notice that the unnatural yellow light from without is pulsing slightly, with the faint electrical buzz of artificial lighting.
